<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>ã˜ã‚…ã‚“ã“ã½ã‚“ã®ç­‹ãƒˆãƒ¬é“å ´</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&family=Noto+Sans+JP:wght@300;400;700;900&display=swap');

  :root {
    --bg: #0f0a1a;
    --surface: #1a1230;
    --surface2: #221940;
    --accent: #ff6b9d;
    --accent2: #c45aef;
    --accent3: #4ecdc4;
    --gold: #ffd166;
    --text: #f0eaff;
    --muted: #8a7aaa;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Noto Sans JP', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background:
      radial-gradient(ellipse at 20% 20%, rgba(196,90,239,0.15) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(255,107,157,0.12) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 480px;
    margin: 0 auto;
    padding: 16px;
  }

  /* ã‚¿ãƒ–ãƒŠãƒ“ */
  .tab-nav {
    display: flex;
    gap: 6px;
    margin-bottom: 16px;
    background: var(--surface);
    padding: 6px;
    border-radius: 16px;
  }

  .tab-btn {
    flex: 1;
    padding: 8px 4px;
    border: none;
    border-radius: 10px;
    background: transparent;
    color: var(--muted);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 0.72rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
  }

  .tab-btn.active {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
  }

  .tab-content { display: none; }
  .tab-content.active { display: block; }

  /* ãƒ˜ãƒƒãƒ€ãƒ¼ */
  .header {
    text-align: center;
    padding: 12px 0 16px;
  }

  .header h1 {
    font-family: 'Zen Maru Gothic', sans-serif;
    font-size: 1.4rem;
    font-weight: 900;
    background: linear-gradient(135deg, var(--accent), var(--accent2), var(--accent3));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  /* ã‚¹ãƒˆãƒªãƒ¼ã‚¯ */
  .streak-bar {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
    background: var(--surface);
    border-radius: 16px;
    padding: 12px 16px;
    margin-bottom: 14px;
  }

  .streak-num {
    font-family: 'Zen Maru Gothic', sans-serif;
    font-size: 2rem;
    font-weight: 900;
    color: var(--gold);
    line-height: 1;
  }

  .streak-label { font-size: 0.75rem; color: var(--muted); }

  .streak-divider {
    width: 1px;
    height: 36px;
    background: rgba(255,255,255,0.1);
  }

  /* ä»Šæ—¥ã‚«ãƒ¼ãƒ‰ */
  .today-card {
    background: linear-gradient(135deg, var(--surface), var(--surface2));
    border: 1px solid rgba(255,107,157,0.3);
    border-radius: 18px;
    padding: 16px;
    margin-bottom: 14px;
    position: relative;
    overflow: hidden;
  }

  .today-label {
    font-size: 0.68rem;
    color: var(--accent);
    font-weight: 700;
    letter-spacing: 0.1em;
    margin-bottom: 4px;
  }

  .today-day {
    font-family: 'Zen Maru Gothic', sans-serif;
    font-size: 1.8rem;
    font-weight: 900;
    line-height: 1;
    margin-bottom: 6px;
  }

  .today-type {
    display: inline-block;
    background: rgba(255,107,157,0.2);
    border: 1px solid rgba(255,107,157,0.5);
    color: var(--accent);
    padding: 3px 10px;
    border-radius: 20px;
    font-size: 0.78rem;
    font-weight: 700;
    margin-bottom: 8px;
  }

  .today-goal { font-size: 0.78rem; color: var(--muted); }

  /* é€±ã‚°ãƒªãƒƒãƒ‰ */
  .week-card {
    background: var(--surface);
    border-radius: 16px;
    padding: 14px;
    margin-bottom: 14px;
  }

  .week-card h3 { font-size: 0.72rem; color: var(--muted); font-weight: 700; margin-bottom: 10px; }

  .week-grid {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
  }

  .day-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 3px;
    padding: 7px 2px;
    border-radius: 10px;
    cursor: pointer;
    border: none;
    background: var(--surface2);
    color: var(--muted);
    transition: all 0.2s;
    font-family: 'Noto Sans JP', sans-serif;
  }

  .day-btn.active {
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    color: white;
    box-shadow: 0 3px 12px rgba(255,107,157,0.4);
  }

  .day-btn.gym { background: linear-gradient(135deg, #2a1a40, #3a2055); border: 1px solid rgba(196,90,239,0.3); }
  .day-btn.gym.active { background: linear-gradient(135deg, var(--accent2), #7b2ff7); }

  .day-label { font-size: 0.68rem; font-weight: 700; }
  .day-icon { font-size: 1rem; }
  .day-done { font-size: 0.6rem; color: var(--accent3); height: 10px; }

  /* ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ */
  .progress-wrap { margin-bottom: 12px; }
  .progress-bar {
    background: var(--surface);
    border-radius: 100px;
    height: 7px;
    overflow: hidden;
    margin-bottom: 4px;
  }
  .progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--accent), var(--accent2));
    border-radius: 100px;
    transition: width 0.4s ease;
    width: 0%;
  }
  .progress-text { font-size: 0.72rem; color: var(--muted); text-align: right; }

  /* ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
  .section-title {
    font-family: 'Zen Maru Gothic', sans-serif;
    font-size: 0.95rem;
    font-weight: 900;
    margin-bottom: 10px;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .badge {
    font-size: 0.68rem;
    background: rgba(78,205,196,0.2);
    border: 1px solid rgba(78,205,196,0.4);
    color: var(--accent3);
    padding: 2px 8px;
    border-radius: 20px;
    font-weight: 700;
  }

  .exercise-card {
    background: var(--surface);
    border-radius: 14px;
    padding: 12px 14px;
    margin-bottom: 8px;
    border-left: 3px solid transparent;
    cursor: pointer;
    transition: all 0.2s;
  }

  .exercise-card:hover { background: var(--surface2); }

  .exercise-card.done {
    opacity: 0.5;
    border-left-color: var(--accent3);
  }

  .ex-top {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    margin-bottom: 8px;
  }

  .ex-number {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), var(--accent2));
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.68rem;
    font-weight: 900;
    flex-shrink: 0;
  }

  .ex-content { flex: 1; }

  .ex-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
  }

  .ex-name { font-weight: 700; font-size: 0.88rem; line-height: 1.3; }

  .done-badge {
    font-size: 0.65rem;
    color: var(--accent3);
    font-weight: 700;
    display: none;
  }
  .exercise-card.done .done-badge { display: block; }

  .ex-detail {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin: 6px 0;
  }

  .tag {
    font-size: 0.65rem;
    padding: 2px 7px;
    border-radius: 8px;
    font-weight: 700;
  }

  .tag-set { background: rgba(255,107,157,0.15); color: var(--accent); }
  .tag-rep { background: rgba(196,90,239,0.15); color: var(--accent2); }
  .tag-weight { background: rgba(255,209,102,0.15); color: var(--gold); }
  .tag-target { background: rgba(78,205,196,0.1); color: var(--accent3); }

  .ex-point { font-size: 0.7rem; color: var(--muted); line-height: 1.5; margin-bottom: 8px; }

  /* é‡é‡ãƒ¡ãƒ¢æ¬„ */
  .weight-memo {
    display: flex;
    align-items: center;
    gap: 8px;
    background: var(--surface2);
    border-radius: 8px;
    padding: 6px 10px;
  }

  .weight-memo label { font-size: 0.68rem; color: var(--muted); white-space: nowrap; }

  .weight-input {
    flex: 1;
    background: transparent;
    border: none;
    border-bottom: 1px solid rgba(255,209,102,0.3);
    color: var(--gold);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 0.8rem;
    font-weight: 700;
    padding: 2px 4px;
    outline: none;
    min-width: 0;
  }

  .weight-input::placeholder { color: rgba(255,209,102,0.3); }
  .weight-input:focus { border-bottom-color: var(--gold); }

  .weight-unit { font-size: 0.68rem; color: var(--muted); }

  /* å®Œäº† */
  .all-done {
    display: none;
    text-align: center;
    padding: 24px 16px;
    animation: popIn 0.5s ease;
  }
  .all-done.show { display: block; }
  .all-done .emoji { font-size: 2.5rem; margin-bottom: 10px; }
  .all-done h2 {
    font-family: 'Zen Maru Gothic', sans-serif;
    font-size: 1.3rem;
    font-weight: 900;
    background: linear-gradient(135deg, var(--accent), var(--gold));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 6px;
  }
  .all-done p { color: var(--muted); font-size: 0.82rem; }

  .reset-btn {
    display: block;
    width: 100%;
    margin-top: 16px;
    padding: 10px;
    background: transparent;
    border: 1px solid rgba(138,122,170,0.3);
    border-radius: 10px;
    color: var(--muted);
    font-family: 'Noto Sans JP', sans-serif;
    font-size: 0.78rem;
    cursor: pointer;
    transition: all 0.2s;
  }
  .reset-btn:hover { border-color: var(--accent); color: var(--accent); }

  /* ========== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ãƒ– ========== */
  .calendar-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }

  .cal-nav {
    background: var(--surface);
    border: none;
    color: var(--text);
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    font-size: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
  }
  .cal-nav:hover { background: var(--surface2); }

  .cal-month {
    font-family: 'Zen Maru Gothic', sans-serif;
    font-size: 1.1rem;
    font-weight: 900;
  }

  .cal-grid {
    background: var(--surface);
    border-radius: 16px;
    padding: 14px;
    margin-bottom: 14px;
  }

  .cal-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    margin-bottom: 8px;
  }

  .cal-weekday {
    text-align: center;
    font-size: 0.65rem;
    color: var(--muted);
    font-weight: 700;
    padding: 4px 0;
  }

  .cal-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 4px;
  }

  .cal-day {
    aspect-ratio: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    font-size: 0.78rem;
    font-weight: 700;
    color: var(--muted);
    position: relative;
    cursor: default;
  }

  .cal-day.today {
    background: rgba(255,107,157,0.2);
    color: var(--accent);
    border: 1px solid rgba(255,107,157,0.4);
  }

  .cal-day.done-day {
    background: linear-gradient(135deg, rgba(78,205,196,0.2), rgba(196,90,239,0.2));
    color: var(--text);
  }

  .cal-day.done-day::after {
    content: 'âœ“';
    position: absolute;
    bottom: 2px;
    font-size: 0.5rem;
    color: var(--accent3);
  }

  .cal-day.other-month { opacity: 0.3; }

  /* é€±é”æˆç‡ */
  .weekly-stats {
    background: var(--surface);
    border-radius: 16px;
    padding: 14px;
    margin-bottom: 14px;
  }

  .weekly-stats h3 {
    font-size: 0.72rem;
    color: var(--muted);
    font-weight: 700;
    margin-bottom: 12px;
  }

  .week-bars {
    display: flex;
    align-items: flex-end;
    gap: 6px;
    height: 80px;
    margin-bottom: 6px;
  }

  .week-bar-wrap {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    height: 100%;
    justify-content: flex-end;
  }

  .week-bar {
    width: 100%;
    border-radius: 4px 4px 0 0;
    background: linear-gradient(180deg, var(--accent2), var(--accent));
    transition: height 0.4s ease;
    min-height: 3px;
  }

  .week-bar-pct { font-size: 0.58rem; color: var(--muted); }
  .week-bar-label { font-size: 0.62rem; color: var(--muted); }

  /* é‡é‡å±¥æ­´ã‚¿ãƒ– */
  .weight-history {
    background: var(--surface);
    border-radius: 16px;
    padding: 14px;
    margin-bottom: 10px;
  }

  .weight-history h3 {
    font-size: 0.72rem;
    color: var(--muted);
    font-weight: 700;
    margin-bottom: 12px;
  }

  .wh-item {
    padding: 8px 0;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }

  .wh-item:last-child { border-bottom: none; }

  .wh-name {
    font-size: 0.8rem;
    font-weight: 700;
    margin-bottom: 4px;
  }

  .wh-entries {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }

  .wh-entry {
    background: rgba(255,209,102,0.1);
    border: 1px solid rgba(255,209,102,0.2);
    border-radius: 6px;
    padding: 2px 8px;
    font-size: 0.68rem;
    color: var(--gold);
  }

  .wh-date { color: var(--muted); }

  .no-data {
    text-align: center;
    color: var(--muted);
    font-size: 0.8rem;
    padding: 20px;
  }

  /* ãƒ«ãƒ¼ãƒ« */
  .rule-card {
    background: var(--surface);
    border-radius: 14px;
    padding: 14px;
    margin-top: 16px;
  }

  .rule-card h4 { font-size: 0.72rem; color: var(--muted); font-weight: 700; margin-bottom: 10px; }

  .rule-item {
    display: flex;
    gap: 8px;
    margin-bottom: 7px;
    font-size: 0.78rem;
    line-height: 1.5;
    align-items: flex-start;
  }

  .rule-icon { font-size: 0.95rem; flex-shrink: 0; }
  .rule-text { color: var(--muted); }
  .rule-text strong { color: var(--text); }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }

  @keyframes popIn {
    0% { transform: scale(0.8); opacity: 0; }
    70% { transform: scale(1.05); }
    100% { transform: scale(1); opacity: 1; }
  }

  .animate { animation: fadeUp 0.4s ease both; }
</style>
</head>
<body>
<div class="container">
  <div class="header">
    <h1>ğŸ’ª ã˜ã‚…ã‚“ã“ã½ã‚“ã®ç­‹ãƒˆãƒ¬é“å ´</h1>
  </div>

  <!-- ã‚¿ãƒ–ãƒŠãƒ“ -->
  <div class="tab-nav">
    <button class="tab-btn active" onclick="switchTab('today')">ğŸ‹ï¸ ä»Šæ—¥</button>
    <button class="tab-btn" onclick="switchTab('calendar')">ğŸ“… è¨˜éŒ²</button>
    <button class="tab-btn" onclick="switchTab('weights')">âš–ï¸ é‡é‡</button>
  </div>

  <!-- ========== ä»Šæ—¥ã‚¿ãƒ– ========== -->
  <div class="tab-content active" id="tab-today">

    <!-- ã‚¹ãƒˆãƒªãƒ¼ã‚¯ -->
    <div class="streak-bar animate">
      <div style="text-align:center">
        <div class="streak-num" id="streakNum">0</div>
        <div class="streak-label">ğŸ”¥ é€£ç¶šæ—¥æ•°</div>
      </div>
      <div class="streak-divider"></div>
      <div style="text-align:center">
        <div class="streak-num" id="totalNum">0</div>
        <div class="streak-label">ğŸ“Š ä»Šæœˆã®å›æ•°</div>
      </div>
      <div class="streak-divider"></div>
      <div style="text-align:center">
        <div class="streak-num" id="weekPct">0%</div>
        <div class="streak-label">ä»Šé€±é”æˆç‡</div>
      </div>
    </div>

    <!-- ä»Šæ—¥ã‚«ãƒ¼ãƒ‰ -->
    <div class="today-card animate">
      <div class="today-label">TODAY</div>
      <div class="today-day" id="todayDayName">---</div>
      <div class="today-type" id="todayType">---</div>
      <div class="today-goal" id="todayGoal"></div>
    </div>

    <!-- é€±ã‚°ãƒªãƒƒãƒ‰ -->
    <div class="week-card animate">
      <h3>ğŸ“† é€±é–“ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆã‚¿ãƒƒãƒ—ã§åˆ‡ã‚Šæ›¿ãˆï¼‰</h3>
      <div class="week-grid" id="weekGrid"></div>
    </div>

    <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ -->
    <div class="progress-wrap animate">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">0 / 0 å®Œäº†</div>
    </div>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="menuSection"></div>

    <!-- å®Œäº† -->
    <div class="all-done" id="allDone">
      <div class="emoji">ğŸ‰âœ¨ğŸ’ª</div>
      <h2>å…¨ãƒ¡ãƒ‹ãƒ¥ãƒ¼å®Œäº†ï¼ï¼</h2>
      <p>ã•ã™ãŒã˜ã‚…ã‚“ã“ã½ã‚“å…ˆç”Ÿï¼<br>ä»Šæ—¥ã‚‚ã‚„ã‚Šãã‚Šã¾ã—ãŸï¼</p>
    </div>

    <button class="reset-btn" onclick="resetToday()">â†º ä»Šæ—¥ã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆ</button>

    <div class="rule-card">
      <h4>ğŸ“ é‡é‡è¨˜éŒ²ãƒ«ãƒ¼ãƒ«</h4>
      <div class="rule-item">
        <span class="rule-icon">ğŸ‹ï¸</span>
        <span class="rule-text"><strong>ãƒãƒ¼ãƒ™ãƒ«ç³»</strong> â†’ ãƒãƒ¼è¾¼ã¿ã®ç·é‡é‡<br>ä¾‹ï¼šãƒãƒ¼9.7kgï¼‹ãƒ—ãƒ¬ãƒ¼ãƒˆ â†’ åˆè¨ˆã‚’è¨˜éŒ²</span>
      </div>
      <div class="rule-item">
        <span class="rule-icon">ğŸ”µ</span>
        <span class="rule-text"><strong>ãƒ€ãƒ³ãƒ™ãƒ«ç³»</strong> â†’ ç‰‡æ‰‹åˆ†ã®é‡é‡ã®ã¿</span>
      </div>
      <div class="rule-item">
        <span class="rule-icon">ğŸ”§</span>
        <span class="rule-text"><strong>ãƒã‚·ãƒ³ç³»</strong> â†’ ãƒã‚·ãƒ³è¡¨ç¤ºã®æ•°å­—ãã®ã¾ã¾</span>
      </div>
    </div>
  </div>

  <!-- ========== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ãƒ– ========== -->
  <div class="tab-content" id="tab-calendar">
    <div class="calendar-header">
      <button class="cal-nav" onclick="changeMonth(-1)">â—€</button>
      <div class="cal-month" id="calMonth"></div>
      <button class="cal-nav" onclick="changeMonth(1)">â–¶</button>
    </div>

    <div class="cal-grid">
      <div class="cal-weekdays">
        <div class="cal-weekday" style="color:#ff6b9d">æ—¥</div>
        <div class="cal-weekday">æœˆ</div>
        <div class="cal-weekday">ç«</div>
        <div class="cal-weekday">æ°´</div>
        <div class="cal-weekday">æœ¨</div>
        <div class="cal-weekday">é‡‘</div>
        <div class="cal-weekday" style="color:#4ecdc4">åœŸ</div>
      </div>
      <div class="cal-days" id="calDays"></div>
    </div>

    <div class="weekly-stats">
      <h3>ğŸ“Š éå»8é€±é–“ã®é”æˆç‡</h3>
      <div class="week-bars" id="weekBars"></div>
      <div style="display:flex; gap:6px; justify-content:center" id="weekBarLabels"></div>
    </div>

    <div id="calDayDetail" style="display:none; background:var(--surface); border-radius:14px; padding:14px; margin-bottom:10px;">
      <h4 id="calDayDetailTitle" style="font-size:0.82rem; margin-bottom:8px;"></h4>
      <div id="calDayDetailContent"></div>
    </div>
  </div>

  <!-- ========== é‡é‡ã‚¿ãƒ– ========== -->
  <div class="tab-content" id="tab-weights">
    <div class="weight-history">
      <h3>âš–ï¸ ç¨®ç›®åˆ¥ é‡é‡å±¥æ­´</h3>
      <div id="weightHistoryContent"></div>
    </div>
  </div>

</div>

<script>
// ========== ãƒ‡ãƒ¼ã‚¿å®šç¾© ==========
const scheduleData = {
  0: {
    name: 'æ—¥æ›œ', type: 'ğŸ‹ï¸ ã‚¸ãƒ ï¼ˆä¸ŠåŠèº«ï¼‰', typeClass: 'gym',
    goal: 'æŒ¯ã‚Šè¢–é™¤å»ãƒ»è‚©ã®ä¸¸ã¿ãƒ»èƒŒä¸­ã‚¹ãƒƒã‚­ãƒª', icon: 'ğŸ‹ï¸', dayType: 'ä¸ŠåŠèº«',
    exercises: [
      { name: 'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', target: 'ä¸Šèƒ¸ãƒ»è‚©å‰éƒ¨', sets: '3ã‚»ãƒƒãƒˆ', reps: '10å›', weight: '22.2kg', point: 'è‚©ç”²éª¨ã‚’å¯„ã›ã‚‹ãƒ»ã‚†ã£ãã‚Šä¸‹ã‚ã™' },
      { name: 'ã‚±ãƒ¼ãƒ–ãƒ«ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³', target: 'ä¸‰é ­ç­‹ï¼ˆæŒ¯ã‚Šè¢–ï¼ï¼‰', sets: '3ã‚»ãƒƒãƒˆ', reps: '12ã€œ15å›', weight: 'æ¬¡å›è¨˜éŒ²ğŸ“', point: 'è‚˜ã‚’å›ºå®šï¼è…•ã ã‘å‹•ã‹ã™' },
      { name: 'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³', target: 'åºƒèƒŒç­‹ãƒ»äºŒé ­ç­‹', sets: '3ã‚»ãƒƒãƒˆ', reps: '10ã€œ12å›', weight: '18.2kg', point: 'èƒ¸ã‚’å¼µã£ã¦å¼•ããƒ»è‚˜ã‚’ä¸‹ã«' },
      { name: 'ã‚·ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ­ã‚¦', target: 'åºƒèƒŒç­‹ãƒ»è±å½¢ç­‹', sets: '3ã‚»ãƒƒãƒˆ', reps: '10ã€œ12å›', weight: 'æ¬¡å›è¨˜éŒ²ğŸ“', point: 'èƒŒä¸­ã‚’ä½¿ã†æ„è­˜ãƒ»è‚©ã‚’ã™ãã‚ãªã„' },
      { name: 'ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º', target: 'ä¸‰è§’ç­‹ï¼ˆè‚©ã®ä¸¸ã¿ï¼‰', sets: '3ã‚»ãƒƒãƒˆ', reps: '12ã€œ15å›', weight: '2ã€œ3kg', point: 'è‚˜ã‚’å°‘ã—æ›²ã’ã‚‹ãƒ»çœŸæ¨ªã«ä¸Šã’ã‚‹' },
      { name: 'ã‚¹ã‚«ãƒ«ã‚¯ãƒ©ãƒƒã‚·ãƒ£ãƒ¼ï¼ˆãƒ€ãƒ³ãƒ™ãƒ«ï¼‰', target: 'ä¸‰é ­ç­‹ï¼ˆæŒ¯ã‚Šè¢–ï¼ï¼‰', sets: '2ã€œ3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: '3ã€œ5kg', point: 'è‚˜ã‚’å›ºå®šãƒ»ã‚†ã£ãã‚Šä¸‹ã’ã‚‹' },
    ]
  },
  1: {
    name: 'æœˆæ›œ', type: 'ğŸ  å®¶ãƒˆãƒ¬ï¼ˆä¸‹åŠèº«ï¼‹ä½“å¹¹ï¼‰', typeClass: '',
    goal: 'ä¸‹è…¹å‡¹ã¾ã›ãƒ»å†…è…¿ã‚¹ãƒƒã‚­ãƒªãƒ»ãŠå°»å¼•ãä¸Šã’', icon: 'ğŸ ', dayType: 'ä¸‹åŠèº«',
    exercises: [
      { name: 'ãƒ—ãƒ©ãƒ³ã‚¯ âš ï¸ã‚¢ãƒ—ãƒªèµ·å‹•ã›ã‚ˆï¼', target: 'ãŠè…¹ãƒ»ä½“å¹¹ãƒ»ä¸‹è…¹', sets: '3ã‚»ãƒƒãƒˆ', reps: '30ç§’ã€œ', weight: 'è‡ªé‡', point: 'ãŠå°»ä¸Šã’ã™ããªã„ãƒ»é ­ã‹ã‚‰è¸µä¸€ç›´ç·š' },
      { name: 'ãƒ’ãƒƒãƒ—ãƒ’ãƒ³ã‚¸', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: 'è‡ªé‡', point: 'è…°ã‚’ä¸¸ã‚ãªã„ãƒ»ã‚†ã£ãã‚Šå‹•ã' },
      { name: 'ã‚µã‚¤ãƒ‰ãƒ©ã‚¤ã‚¤ãƒ³ã‚°ã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«', target: 'å†…è…¿ãƒ»ãŠå°»å¤–å´', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³15å›', weight: 'è‡ªé‡', point: 'è…°ã‚’ã²ã­ã‚‰ãªã„' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: '5kg', point: 'è…°ã¾ã£ã™ã' },
      { name: 'ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚µã‚¤ãƒ‰ã‚­ãƒƒã‚¯', target: 'ãŠå°»å¤–å´ãƒ»å†…è…¿', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³15å›', weight: 'è‡ªé‡', point: 'ä¸Šä½“ã¯ã¾ã£ã™ã' },
    ]
  },
  2: {
    name: 'ç«æ›œ', type: 'ğŸ  å®¶ãƒˆãƒ¬ï¼ˆä¸ŠåŠèº«ï¼‹ã‚¦ã‚¨ã‚¹ãƒˆï¼‰', typeClass: '',
    goal: 'æŒ¯ã‚Šè¢–é™¤å»ãƒ»ã‚¦ã‚¨ã‚¹ãƒˆå¼•ãç· ã‚ãƒ»è‚©ã®ä¸¸ã¿', icon: 'ğŸ ', dayType: 'ä¸ŠåŠèº«',
    exercises: [
      { name: 'ã‚¦ã‚©ãƒ¼ãƒ«ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—', target: 'èƒ¸ãƒ»ä¸‰é ­ç­‹ãƒ»è‚©', sets: '2ã€œ3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: 'è‡ªé‡', point: 'ä½“ã‚’æ¿ã®ã‚ˆã†ã«ãƒ»è‚˜ã¯ã‚„ã‚„å¤–å‘ã' },
      { name: 'ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ã‚­ãƒƒã‚¯ãƒãƒƒã‚¯', target: 'ä¸‰é ­ç­‹ï¼ˆæŒ¯ã‚Šè¢–ï¼ï¼‰', sets: '3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: '5kg', point: 'è‚˜ã‚’é«˜ãå›ºå®š' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º', target: 'ä¸‰è§’ç­‹ï¼ˆè‚©ã®ä¸¸ã¿ï¼‰', sets: '3ã‚»ãƒƒãƒˆ', reps: '12ã€œ15å›', weight: '2ã€œ3kg', point: 'ãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆï¼' },
      { name: 'ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ„ã‚¤ã‚¹ãƒˆ', target: 'ã‚¦ã‚¨ã‚¹ãƒˆãƒ»è…¹æ–œç­‹', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³20å›', weight: 'è‡ªé‡', point: 'è…°ã‹ã‚‰ã²ã­ã‚‹' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹', target: 'ä¸‰é ­ç­‹ï¼ˆæŒ¯ã‚Šè¢–ï¼ï¼‰', sets: '2ã€œ3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: '3ã€œ5kg', point: 'è‚˜ã‚’é ­ã®æ¨ªã«å›ºå®š' },
    ]
  },
  3: {
    name: 'æ°´æ›œ', type: 'ğŸ  å®¶ãƒˆãƒ¬ï¼ˆä¸‹åŠèº«ï¼‹ä½“å¹¹ï¼‰', typeClass: '',
    goal: 'ä¸‹è…¹å‡¹ã¾ã›ãƒ»å†…è…¿ã‚¹ãƒƒã‚­ãƒªãƒ»ãŠå°»å¼•ãä¸Šã’', icon: 'ğŸ ', dayType: 'ä¸‹åŠèº«',
    exercises: [
      { name: 'ãƒ—ãƒ©ãƒ³ã‚¯ âš ï¸ã‚¢ãƒ—ãƒªèµ·å‹•ã›ã‚ˆï¼', target: 'ãŠè…¹ãƒ»ä½“å¹¹ãƒ»ä¸‹è…¹', sets: '3ã‚»ãƒƒãƒˆ', reps: '30ç§’ã€œ', weight: 'è‡ªé‡', point: 'ãŠå°»ä¸Šã’ã™ããªã„ãƒ»é ­ã‹ã‚‰è¸µä¸€ç›´ç·š' },
      { name: 'ãƒ’ãƒƒãƒ—ãƒ’ãƒ³ã‚¸', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: 'è‡ªé‡', point: 'è…°ã‚’ä¸¸ã‚ãªã„ãƒ»ã‚†ã£ãã‚Šå‹•ã' },
      { name: 'ã‚µã‚¤ãƒ‰ãƒ©ã‚¤ã‚¤ãƒ³ã‚°ã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«', target: 'å†…è…¿ãƒ»ãŠå°»å¤–å´', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³15å›', weight: 'è‡ªé‡', point: 'è…°ã‚’ã²ã­ã‚‰ãªã„' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: '5kg', point: 'è…°ã¾ã£ã™ã' },
      { name: 'ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚µã‚¤ãƒ‰ã‚­ãƒƒã‚¯', target: 'ãŠå°»å¤–å´ãƒ»å†…è…¿', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³15å›', weight: 'è‡ªé‡', point: 'ä¸Šä½“ã¯ã¾ã£ã™ã' },
    ]
  },
  4: {
    name: 'æœ¨æ›œ', type: 'ğŸ  å®¶ãƒˆãƒ¬ï¼ˆä¸ŠåŠèº«ï¼‹ã‚¦ã‚¨ã‚¹ãƒˆï¼‰', typeClass: '',
    goal: 'æŒ¯ã‚Šè¢–é™¤å»ãƒ»ã‚¦ã‚¨ã‚¹ãƒˆå¼•ãç· ã‚ãƒ»è‚©ã®ä¸¸ã¿', icon: 'ğŸ ', dayType: 'ä¸ŠåŠèº«',
    exercises: [
      { name: 'ã‚¦ã‚©ãƒ¼ãƒ«ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—', target: 'èƒ¸ãƒ»ä¸‰é ­ç­‹ãƒ»è‚©', sets: '2ã€œ3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: 'è‡ªé‡', point: 'ä½“ã‚’æ¿ã®ã‚ˆã†ã«ãƒ»è‚˜ã¯ã‚„ã‚„å¤–å‘ã' },
      { name: 'ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ã‚­ãƒƒã‚¯ãƒãƒƒã‚¯', target: 'ä¸‰é ­ç­‹ï¼ˆæŒ¯ã‚Šè¢–ï¼ï¼‰', sets: '3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: '5kg', point: 'è‚˜ã‚’é«˜ãå›ºå®š' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º', target: 'ä¸‰è§’ç­‹ï¼ˆè‚©ã®ä¸¸ã¿ï¼‰', sets: '3ã‚»ãƒƒãƒˆ', reps: '12ã€œ15å›', weight: '2ã€œ3kg', point: 'ãƒ•ã‚©ãƒ¼ãƒ å„ªå…ˆï¼' },
      { name: 'ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ãƒ„ã‚¤ã‚¹ãƒˆ', target: 'ã‚¦ã‚¨ã‚¹ãƒˆãƒ»è…¹æ–œç­‹', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³20å›', weight: 'è‡ªé‡', point: 'è…°ã‹ã‚‰ã²ã­ã‚‹' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚ªãƒ¼ãƒãƒ¼ãƒ˜ãƒƒãƒ‰ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹', target: 'ä¸‰é ­ç­‹ï¼ˆæŒ¯ã‚Šè¢–ï¼ï¼‰', sets: '2ã€œ3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: '3ã€œ5kg', point: 'è‚˜ã‚’é ­ã®æ¨ªã«å›ºå®š' },
    ]
  },
  5: {
    name: 'é‡‘æ›œ', type: 'ğŸ  å®¶ãƒˆãƒ¬ï¼ˆä¸‹åŠèº«ï¼‹ä½“å¹¹ï¼‰', typeClass: '',
    goal: 'ä¸‹è…¹å‡¹ã¾ã›ãƒ»å†…è…¿ã‚¹ãƒƒã‚­ãƒªãƒ»ãŠå°»å¼•ãä¸Šã’', icon: 'ğŸ ', dayType: 'ä¸‹åŠèº«',
    exercises: [
      { name: 'ãƒ—ãƒ©ãƒ³ã‚¯ âš ï¸ã‚¢ãƒ—ãƒªèµ·å‹•ã›ã‚ˆï¼', target: 'ãŠè…¹ãƒ»ä½“å¹¹ãƒ»ä¸‹è…¹', sets: '3ã‚»ãƒƒãƒˆ', reps: '30ç§’ã€œ', weight: 'è‡ªé‡', point: 'ãŠå°»ä¸Šã’ã™ããªã„ãƒ»é ­ã‹ã‚‰è¸µä¸€ç›´ç·š' },
      { name: 'ãƒ’ãƒƒãƒ—ãƒ’ãƒ³ã‚¸', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '15å›', weight: 'è‡ªé‡', point: 'è…°ã‚’ä¸¸ã‚ãªã„ãƒ»ã‚†ã£ãã‚Šå‹•ã' },
      { name: 'ã‚µã‚¤ãƒ‰ãƒ©ã‚¤ã‚¤ãƒ³ã‚°ã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«', target: 'å†…è…¿ãƒ»ãŠå°»å¤–å´', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³15å›', weight: 'è‡ªé‡', point: 'è…°ã‚’ã²ã­ã‚‰ãªã„' },
      { name: 'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: '5kg', point: 'è…°ã¾ã£ã™ã' },
      { name: 'ã‚¹ã‚¿ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã‚µã‚¤ãƒ‰ã‚­ãƒƒã‚¯', target: 'ãŠå°»å¤–å´ãƒ»å†…è…¿', sets: '2ã‚»ãƒƒãƒˆ', reps: 'å·¦å³15å›', weight: 'è‡ªé‡', point: 'ä¸Šä½“ã¯ã¾ã£ã™ã' },
    ]
  },
  6: {
    name: 'åœŸæ›œ', type: 'ğŸ‹ï¸ ã‚¸ãƒ ï¼ˆä¸‹åŠèº«ï¼‰', typeClass: 'gym',
    goal: 'å†…è…¿ã‚¹ãƒƒã‚­ãƒªãƒ»ãŠå°»å¼•ãä¸Šã’ãƒ»å‰ãƒ¢ãƒ¢å¼•ãç· ã‚', icon: 'ğŸ‹ï¸', dayType: 'ä¸‹åŠèº«',
    exercises: [
      { name: 'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', target: 'å‰ãƒ¢ãƒ¢ãƒ»ãŠå°»ãƒ»å†…è…¿', sets: '3ã‚»ãƒƒãƒˆ', reps: '10ã€œ15å›', weight: '17.2kg', point: 'è†ãŒã¤ã¾å…ˆã‚ˆã‚Šå‡ºãªã„ãƒ»èƒŒç­‹ã¾ã£ã™ã' },
      { name: 'ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ', target: 'ãŠå°»ãƒ»ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹', sets: '3ã‚»ãƒƒãƒˆ', reps: '10ã€œ15å›', weight: '19.7kg', point: 'ãŠå°»ã‚’ã—ã£ã‹ã‚Šåç¸®ãƒ»è…°ã‚’åã‚‰ãªã„' },
      { name: 'ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', target: 'ãŠå°»ãƒ»å‰ãƒ¢ãƒ¢ãƒ»å†…è…¿', sets: '2ã€œ3ã‚»ãƒƒãƒˆ', reps: '10å›', weight: '9.7kg', point: 'å‰è¶³ã«é‡å¿ƒãƒ»ãƒãƒ©ãƒ³ã‚¹æ³¨æ„' },
      { name: 'ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ', target: 'ãƒãƒ ã‚¹ãƒˆãƒªãƒ³ã‚°ã‚¹ãƒ»ãŠå°»', sets: '3ã‚»ãƒƒãƒˆ', reps: '10å›', weight: '6ã€œ8kg', point: 'è…°ã‚’ä¸¸ã‚ãªã„ãƒ»ã‚†ã£ãã‚Šä¸‹ã‚ã™' },
      { name: 'ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹ï¼ˆã‚ã‚Œã°ï¼‰', target: 'å‰ãƒ¢ãƒ¢ãƒ»ãŠå°»å…¨ä½“', sets: '3ã‚»ãƒƒãƒˆ', reps: '12å›', weight: 'è©¦ã—ãªãŒã‚‰', point: 'è†ã‚’æ·±ãæ›²ã’ã‚‹ãƒ»è¶³å¹…åºƒã‚' },
    ]
  }
};

const dayNames = ['æ—¥', 'æœˆ', 'ç«', 'æ°´', 'æœ¨', 'é‡‘', 'åœŸ'];
let currentDay = new Date().getDay();
let calYear = new Date().getFullYear();
let calMonth = new Date().getMonth();

// ========== ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ ==========
function dateKey(d) {
  return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;
}

function todayKey() { return dateKey(new Date()); }

function getChecked(day) {
  try { return JSON.parse(localStorage.getItem(`jt_check_${todayKey()}_d${day}`)) || {}; } catch(e) { return {}; }
}

function saveChecked(day, data) {
  try { localStorage.setItem(`jt_check_${todayKey()}_d${day}`, JSON.stringify(data)); } catch(e) {}
}

function getDayRecord(dateStr) {
  try { return JSON.parse(localStorage.getItem(`jt_done_${dateStr}`)) || null; } catch(e) { return null; }
}

function saveDayRecord(dateStr, data) {
  try { localStorage.setItem(`jt_done_${dateStr}`, JSON.stringify(data)); } catch(e) {}
}

function getWeightMemo(exName, dateStr) {
  try { return localStorage.getItem(`jt_weight_${exName}_${dateStr}`) || ''; } catch(e) { return ''; }
}

function saveWeightMemo(exName, dateStr, val) {
  try { localStorage.setItem(`jt_weight_${exName}_${dateStr}`, val); } catch(e) {}
}

function getAllWeightHistory(exName) {
  const results = [];
  try {
    for (let i = 0; i < localStorage.length; i++) {
      const k = localStorage.key(i);
      if (k && k.startsWith(`jt_weight_${exName}_`)) {
        const dateStr = k.replace(`jt_weight_${exName}_`, '');
        const val = localStorage.getItem(k);
        if (val) results.push({ date: dateStr, val });
      }
    }
  } catch(e) {}
  return results.sort((a, b) => b.date.localeCompare(a.date));
}

// ========== çµ±è¨ˆ ==========
function calcStreak() {
  let streak = 0;
  const d = new Date();
  // ä»Šæ—¥ãŒå®Œäº†ã—ã¦ãŸã‚‰ã‚«ã‚¦ãƒ³ãƒˆã€ã—ã¦ãªã‘ã‚Œã°æ˜¨æ—¥ã‹ã‚‰
  const todayDone = getDayRecord(dateKey(d));
  if (!todayDone) d.setDate(d.getDate() - 1);
  
  for (let i = 0; i < 365; i++) {
    const rec = getDayRecord(dateKey(d));
    if (rec && rec.completed) {
      streak++;
      d.setDate(d.getDate() - 1);
    } else break;
  }
  return streak;
}

function calcMonthCount() {
  const now = new Date();
  const y = now.getFullYear(), m = now.getMonth();
  let count = 0;
  const daysInMonth = new Date(y, m+1, 0).getDate();
  for (let i = 1; i <= daysInMonth; i++) {
    const d = new Date(y, m, i);
    const rec = getDayRecord(dateKey(d));
    if (rec && rec.completed) count++;
  }
  return count;
}

function calcWeekPct() {
  const now = new Date();
  const dow = now.getDay();
  let done = 0, total = 0;
  for (let i = 0; i <= dow; i++) {
    const d = new Date(now);
    d.setDate(now.getDate() - dow + i);
    total++;
    const rec = getDayRecord(dateKey(d));
    if (rec && rec.completed) done++;
  }
  return total > 0 ? Math.round(done / total * 100) : 0;
}

function calcWeeklyStats() {
  const now = new Date();
  const results = [];
  for (let w = 7; w >= 0; w--) {
    const weekStart = new Date(now);
    weekStart.setDate(now.getDate() - now.getDay() - w * 7);
    let done = 0;
    for (let d = 0; d < 7; d++) {
      const day = new Date(weekStart);
      day.setDate(weekStart.getDate() + d);
      if (day > now) break;
      const rec = getDayRecord(dateKey(day));
      if (rec && rec.completed) done++;
    }
    const daysInWeek = Math.min(7, Math.floor((now - weekStart) / 86400000) + 1);
    results.push({ pct: daysInWeek > 0 ? Math.round(done / daysInWeek * 100) : 0, label: `${weekStart.getMonth()+1}/${weekStart.getDate()}` });
  }
  return results;
}

// ========== ã‚¿ãƒ– ==========
function switchTab(tab) {
  document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
  document.getElementById(`tab-${tab}`).classList.add('active');
  event.target.classList.add('active');

  if (tab === 'calendar') renderCalendar();
  if (tab === 'weights') renderWeightHistory();
}

// ========== ä»Šæ—¥ã‚¿ãƒ– ==========
function buildWeekGrid() {
  const grid = document.getElementById('weekGrid');
  grid.innerHTML = '';
  dayNames.forEach((name, i) => {
    const d = new Date();
    const diff = i - d.getDay();
    const targetDate = new Date(d);
    targetDate.setDate(d.getDate() + diff);
    const rec = getDayRecord(dateKey(targetDate));
    const isDone = rec && rec.completed;

    const btn = document.createElement('button');
    btn.className = 'day-btn' + (scheduleData[i].typeClass === 'gym' ? ' gym' : '') + (i === currentDay ? ' active' : '');
    btn.innerHTML = `<span class="day-label">${name}</span><span class="day-icon">${scheduleData[i].icon}</span><span class="day-done">${isDone ? 'âœ“' : ''}</span>`;
    btn.onclick = () => switchDay(i);
    grid.appendChild(btn);
  });
}

function switchDay(day) {
  currentDay = day;
  document.querySelectorAll('.day-btn').forEach((btn, i) => btn.classList.toggle('active', i === day));
  const data = scheduleData[day];
  document.getElementById('todayDayName').textContent = data.name;
  document.getElementById('todayType').textContent = data.type;
  document.getElementById('todayGoal').textContent = 'ğŸ¯ ' + data.goal;
  renderMenu();
}

function renderMenu() {
  const data = scheduleData[currentDay];
  const checked = getChecked(currentDay);
  const section = document.getElementById('menuSection');
  const isToday = currentDay === new Date().getDay();
  const dateStr = isToday ? todayKey() : '';

  section.innerHTML = `<div class="section-title animate">ä»Šæ—¥ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ <span class="badge">${data.exercises.length}ç¨®ç›®</span></div>`;

  const colors = ['var(--accent)', 'var(--accent2)', 'var(--accent3)', 'var(--gold)', 'var(--accent)', 'var(--accent2)'];

  data.exercises.forEach((ex, i) => {
    const isDone = checked[i];
    const savedWeight = dateStr ? getWeightMemo(ex.name, dateStr) : '';

    const card = document.createElement('div');
    card.className = 'exercise-card animate' + (isDone ? ' done' : '');
    card.style.borderLeftColor = isDone ? 'var(--accent3)' : colors[i % colors.length];
    card.style.animationDelay = `${i * 0.05}s`;

    card.innerHTML = `
      <div class="ex-top">
        <div class="ex-number">${i+1}</div>
        <div class="ex-content">
          <div class="ex-header">
            <div class="ex-name">${ex.name}</div>
            <span class="done-badge">âœ“ å®Œäº†!</span>
          </div>
          <div class="ex-detail">
            <span class="tag tag-set">${ex.sets}</span>
            <span class="tag tag-rep">${ex.reps}</span>
            <span class="tag tag-weight">âš–ï¸ ${ex.weight}</span>
            <span class="tag tag-target">${ex.target}</span>
          </div>
          <div class="ex-point">ğŸ’¡ ${ex.point}</div>
        </div>
      </div>
      <div class="weight-memo" onclick="event.stopPropagation()">
        <label>ğŸ“ ä»Šæ—¥ã®é‡é‡ï¼š</label>
        <input type="text" class="weight-input" placeholder="${ex.weight}" value="${savedWeight}" 
          data-exname="${ex.name.replace(/"/g,'')}"
          onchange="saveWeight(this)"
          oninput="saveWeight(this)">
        <span class="weight-unit">kg</span>
      </div>
    `;

    card.addEventListener('click', (e) => {
      if (e.target.tagName === 'INPUT') return;
      toggleItem(i);
    });
    section.appendChild(card);
  });

  updateProgress(checked, data.exercises.length);
}

function saveWeight(input) {
  const exName = input.dataset.exname;
  const val = input.value.trim();
  if (val) saveWeightMemo(exName, todayKey(), val);
}

function toggleItem(idx) {
  const checked = getChecked(currentDay);
  checked[idx] = !checked[idx];
  saveChecked(currentDay, checked);

  const data = scheduleData[currentDay];
  const total = data.exercises.length;
  const doneCount = Object.values(checked).filter(Boolean).length;

  // ä»Šæ—¥ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ä¿å­˜
  if (currentDay === new Date().getDay()) {
    saveDayRecord(todayKey(), {
      completed: doneCount === total,
      doneCount,
      total,
      dayOfWeek: currentDay
    });
  }

  renderMenu();
  buildWeekGrid();
  updateStats();
}

function updateProgress(checked, total) {
  const done = Object.values(checked).filter(Boolean).length;
  const pct = total > 0 ? (done / total * 100) : 0;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('progressText').textContent = `${done} / ${total} å®Œäº†`;
  document.getElementById('allDone').classList.toggle('show', done === total && total > 0);
}

function updateStats() {
  document.getElementById('streakNum').textContent = calcStreak();
  document.getElementById('totalNum').textContent = calcMonthCount();
  document.getElementById('weekPct').textContent = calcWeekPct() + '%';
}

function resetToday() {
  if (confirm('ä»Šæ—¥ã®ãƒã‚§ãƒƒã‚¯ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
    localStorage.removeItem(`jt_check_${todayKey()}_d${currentDay}`);
    renderMenu();
  }
}

// ========== ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¿ãƒ– ==========
function renderCalendar() {
  const y = calYear, m = calMonth;
  document.getElementById('calMonth').textContent = `${y}å¹´${m+1}æœˆ`;

  const firstDay = new Date(y, m, 1).getDay();
  const daysInMonth = new Date(y, m+1, 0).getDate();
  const today = new Date();

  const container = document.getElementById('calDays');
  container.innerHTML = '';

  // å‰æœˆã®ç©ºç™½
  for (let i = 0; i < firstDay; i++) {
    const cell = document.createElement('div');
    cell.className = 'cal-day other-month';
    const prevDays = new Date(y, m, 0).getDate();
    cell.textContent = prevDays - firstDay + i + 1;
    container.appendChild(cell);
  }

  for (let d = 1; d <= daysInMonth; d++) {
    const date = new Date(y, m, d);
    const dStr = dateKey(date);
    const rec = getDayRecord(dStr);
    const isToday = date.toDateString() === today.toDateString();

    const cell = document.createElement('div');
    cell.className = 'cal-day' + (isToday ? ' today' : '') + (rec && rec.completed ? ' done-day' : '');
    cell.textContent = d;
    cell.onclick = () => showCalDayDetail(dStr, rec);
    container.appendChild(cell);
  }

  // é€±é–“ã‚°ãƒ©ãƒ•
  renderWeekBars();
}

function showCalDayDetail(dateStr, rec) {
  const detail = document.getElementById('calDayDetail');
  const title = document.getElementById('calDayDetailTitle');
  const content = document.getElementById('calDayDetailContent');

  if (!rec) {
    detail.style.display = 'none';
    return;
  }

  detail.style.display = 'block';
  title.textContent = `${dateStr} ã®è¨˜éŒ²`;
  content.innerHTML = rec.completed
    ? `<div style="color:var(--accent3); font-size:0.85rem">âœ“ å…¨${rec.total}ç¨®ç›®å®Œäº†ï¼</div>`
    : `<div style="color:var(--muted); font-size:0.82rem">${rec.doneCount} / ${rec.total} ç¨®ç›®å®Œäº†</div>`;
}

function renderWeekBars() {
  const stats = calcWeeklyStats();
  const barsEl = document.getElementById('weekBars');
  const labelsEl = document.getElementById('weekBarLabels');
  barsEl.innerHTML = '';
  labelsEl.innerHTML = '';

  stats.forEach(s => {
    const wrap = document.createElement('div');
    wrap.className = 'week-bar-wrap';
    wrap.innerHTML = `
      <div class="week-bar-pct">${s.pct}%</div>
      <div class="week-bar" style="height:${Math.max(3, s.pct * 0.6)}px"></div>
    `;
    barsEl.appendChild(wrap);

    const lbl = document.createElement('div');
    lbl.className = 'week-bar-label';
    lbl.style.flex = '1';
    lbl.style.textAlign = 'center';
    lbl.textContent = s.label;
    labelsEl.appendChild(lbl);
  });
}

function changeMonth(delta) {
  calMonth += delta;
  if (calMonth < 0) { calMonth = 11; calYear--; }
  if (calMonth > 11) { calMonth = 0; calYear++; }
  renderCalendar();
}

// ========== é‡é‡ã‚¿ãƒ– ==========
function renderWeightHistory() {
  const container = document.getElementById('weightHistoryContent');
  container.innerHTML = '';

  // å…¨ç¨®ç›®ã‚’åé›†
  const allExercises = [];
  Object.values(scheduleData).forEach(day => {
    day.exercises.forEach(ex => {
      if (!allExercises.includes(ex.name)) allExercises.push(ex.name);
    });
  });

  let hasAny = false;

  allExercises.forEach(exName => {
    const history = getAllWeightHistory(exName);
    if (history.length === 0) return;
    hasAny = true;

    const item = document.createElement('div');
    item.className = 'wh-item';
    item.innerHTML = `
      <div class="wh-name">${exName}</div>
      <div class="wh-entries">
        ${history.slice(0, 10).map(h => `<div class="wh-entry"><span class="wh-date">${h.date}</span> ${h.val}kg</div>`).join('')}
      </div>
    `;
    container.appendChild(item);
  });

  if (!hasAny) {
    container.innerHTML = '<div class="no-data">ã¾ã é‡é‡ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“ğŸ˜Š<br>ã€Œä»Šæ—¥ã€ã‚¿ãƒ–ã§ç¨®ç›®ã”ã¨ã«<br>é‡é‡ã‚’å…¥åŠ›ã—ã¦ã¿ã¦ãã ã•ã„ï¼</div>';
  }
}

// ========== åˆæœŸåŒ– ==========
window.onload = () => {
  const today = new Date().getDay();
  currentDay = today;
  buildWeekGrid();
  switchDay(today);
  updateStats();
};
</script>
</body>
</html>
